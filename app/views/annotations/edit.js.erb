$('#noteform').remove();
$('#projects').append("<%= escape_javascript(render 'form') %>")

ias = $('#img_note').imgAreaSelect({ handles: true, movable: true, resizable: true, instance: true, enable: true, onSelectChange: show_add_note, x1: <%= @annotation.x1 %>, y1: <%= @annotation.y1 %>, x2: <%= @annotation.x2 %>, y2: <%= @annotation.y2 %> });

function show_add_note (img, area) {
  imgOffset = $('#img_note').offset();
  form_left  = parseInt(imgOffset.left) + parseInt(area.x1);
  form_top   = parseInt(imgOffset.top) + parseInt(area.y1) + parseInt(area.height)+5;


  $('#noteform').css({ left: form_left + 'px', top: form_top + 'px'});
  $('#noteform').show();
  $('#noteform').css("z-index", 10000); 

  $('#annotation_x1').val(area.x1);
  $('#annotation_x2').val(area.x2);
  $('#annotation_y1').val(area.y1);
  $('#annotation_y2').val(area.y2);
  $('#annotation_width').val(area.width);
  $('#annotation_height').val(area.height);
}

imgOffset = $('#img_note').offset();
form_left  = parseInt(imgOffset.left) + <%= @annotation.x1 %>;
form_top   = parseInt(imgOffset.top) + <%= @annotation.y2 %> + 5;

$('#noteform').css({ left: form_left + 'px', top: form_top + 'px'});
$('#noteform').show();
$('#noteform').css("z-index", 10000); 

